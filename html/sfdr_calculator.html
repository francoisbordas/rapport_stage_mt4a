<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calculateur SFDR / MDS — instantané</title>

  <!-- CSS séparé -->
  <link rel="stylesheet" href="../style/sfdr_calculator.css">
</head>
<body>
  <div class="app">

    <!-- TOPBAR -->
    <header class="topbar">
      <div class="left">
        <a id="btnHome" class="home-btn" href="../index.html">HUB</a>
      </div>

      <div class="center">
        <h1 class="title">Calculateur SFDR & MDS — instantané</h1>
        <div class="subtitle">Entrez les paramètres — calculs mis à jour automatiquement.</div>
      </div>

      <div class="right actions">
        <button id="copyBtn" class="btn action">Copier</button>
        <button id="downloadBtn" class="btn ghost action">Télécharger</button>
        <button id="resetBtn" class="btn ghost action" title="Remettre les valeurs par défaut">Réinitialiser</button>
      </div>
    </header>

    <!-- LAYOUT PRINCIPALE -->
    <main class="container">

      <!-- Colonne gauche : Formulaire -->
      <section class="card form-card" aria-labelledby="formTitle">
        <div id="formTitle" class="card-title">Paramètres d'entrée</div>

        <form id="form" autocomplete="off" onsubmit="return false;">
          <!-- bande passante / temperature -->
          <div class="row">
            <div class="field">
              <label for="bw">Bande passante (Hz)</label>
              <input id="bw" type="number" inputmode="numeric" step="1" value="1000000" />
              <div class="help">Ex : 1e6 = 1 MHz</div>
            </div>

            <div class="field">
              <label for="temp">Température (°C)</label>
              <input id="temp" type="number" step="0.1" value="20.0" />
              <div class="help">T[K] = T[°C] + 273.15</div>
            </div>
          </div>

          <!-- gain / NF -->
          <div class="row">
            <div class="field">
              <label for="gain">Gain total (dB)</label>
              <input id="gain" type="number" step="0.1" value="30" />
              <div class="help">Utilisé pour convertir OP1→IP1 si nécessaire</div>
            </div>

            <div class="field">
              <label for="nf">Figure de bruit (NF, dB)</label>
              <input id="nf" type="number" step="0.01" value="3.0" />
            </div>
          </div>

          <!-- mode IP1 / IIP3 -->
          <fieldset class="row mode-row" aria-label="Mode de saisie de la non-linéarité">
            <legend class="sr-only">Mode entrée</legend>

            <div class="mode-options">
              <label class="radio">
                <input type="radio" name="mode" value="ip1" checked>
                <span>IP1 / OP1</span>
              </label>
              <label class="radio">
                <input type="radio" name="mode" value="iip3">
                <span>IIP3 direct</span>
              </label>
            </div>

            <div class="field">
              <label for="ip1">IP1dB (dBm)</label>
              <input id="ip1" type="number" step="0.01" value="18.00" />
              <div class="help">
                Si tu donnes OP1 (sortie), coche la case ci-dessous pour convertir vers l'entrée.
              </div>
            </div>
          </fieldset>

          <!-- options secondary -->
          <div class="row">
            <div class="field checkbox-field">
              <label class="checkbox">
                <input id="ip1_is_output" type="checkbox" />
                <span>IP1 fourni est OP1dB (sortie) — convertir en entrée</span>
              </label>
            </div>

            <div class="field">
              <label for="delta">Δ pour IIP3 ≈ IP1 + Δ (dB)</label>
              <input id="delta" type="number" step="0.1" value="10.0" />
              <div class="help">Valeur empirique (défaut 10 dB). Si IIP3 connu, active le mode IIP3 direct.</div>
            </div>
          </div>

          <!-- IIP3 direct (affiché/masqué par JS) -->
          <div id="iip3row" class="row" style="display:none;">
            <div class="field full">
              <label for="iip3">IIP3 direct (dBm)</label>
              <input id="iip3" type="number" step="0.01" value="28.00" />
              <div class="help">Saisis IIP3 si tu le connais (mode IIP3 direct).</div>
            </div>
          </div>

          <!-- note/formules -->
          <div class="notice">
            <strong>Formules :</strong>
            <div class="mono">
              MDS(dBm) = 10·log10(k · T[K] · BW) + 30 + NF<br/>
              SFDR(dB) = (2/3) · (IIP3 − MDS)
            </div>
          </div>

        </form>
      </section>

      <!-- Colonne droite : Résultats & Aide -->
      <aside class="card aside-card" aria-labelledby="resultsTitle">
        <div id="resultsTitle" class="card-title">Résultats</div>

        <div class="metric">
          <div class="metric-label">IIP3 utilisé</div>
          <div id="iip3_used" class="metric-value">— dBm</div>
        </div>

        <div class="grid-2">
          <div class="metric">
            <div class="metric-label">MDS (dBm)</div>
            <div id="mds_pow" class="metric-value">— dBm</div>
            <div id="mds_expr" class="help small-muted"></div>
          </div>

          <div class="metric">
            <div class="metric-label">SFDR (dB)</div>
            <div id="sfdr" class="metric-value">— dB</div>
            <div class="help small-muted">Plus grand → meilleure plage dynamique</div>
          </div>
        </div>

        <hr/>

        <div class="card-title small">Aide rapide</div>
        <div class="help-block small-muted">
          • Entrez BW en Hz (ex: 1e6 = 1 MHz).<br/>
          • Température en °C (20 → 293.15 K).<br/>
          • Si tu donnes OP1 en sortie, coche la case pour convertir à l'entrée.<br/>
          • Δ est empirique — 10 dB est une valeur courante.
        </div>

        <div style="margin-top:12px" class="card-title small">Export</div>
        <div class="row">
          <button id="copyResults" class="btn compact">Copier les résultats</button>
          <button id="downloadResults" class="btn ghost compact">Télécharger (.txt)</button>
        </div>
      </aside>

    </main>

    <footer class="footer">
      <div>Créé pour la conception RF — instantané & simple.</div>
      <div class="muted">MDS calculé avec k = 1.380649e-23 J/K</div>
    </footer>

  </div>

  <!-- JS séparé -->
  <script defer src="../javascript/sfdr_calculator.js"></script>
</body>
</html>
