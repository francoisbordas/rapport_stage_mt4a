<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Surface Calculator — PCB components surface</title>

  <!-- CSS externe -->
  <link rel="stylesheet" href="../style/surface_calculator.css">

  <!-- YAML helper (js-yaml) -->
  <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js" defer></script>
  <!-- JS principal -->
  <script defer src="../javascript/surface_calculator.js"></script>
</head>

<body data-theme="dark">
  <header class="header-row">
    <a class="home-btn" href="#">HUB</a>
    <h1 class="app-title">Surface Calculator</h1>

    <div class="header-actions">
      <input id="yamlFileInput" type="file" accept=".yaml,.yml,.json" class="hidden" aria-hidden="true">
      <button id="btnImport" class="ghost" title="Importer un fichier (JSON ou YAML)">Importer</button>
      <button id="btnExport" class="ghost" title="Exporter en YAML">Exporter</button>
      <button id="btnDownloadExample" class="ghost" title="Télécharger un exemple">Exemple</button>
      <span id="statusYaml" class="status" role="status" aria-live="polite"></span>
    </div>
  </header>

  <main class="main-grid">

    <!-- LEFT : saisie composants -->
    <section class="card column-left">
      <div class="card-header">
        <div class="title">Entrée composants — unités : <strong>mm / mm²</strong></div>
        <div class="actions">
          <button id="btnAddComp" class="primary">+ Ajouter</button>
          <button id="btnRemoveLast" class="ghost">− Suppr. dernier</button>
        </div>
      </div>

      <div class="inputs-table-header" aria-hidden="true">
        <div class="col idx">#</div>
        <div class="col name">Nom</div>
        <div class="col L">L (mm)</div>
        <div class="col l">l (mm)</div>
        <div class="col crown">Couronne (mm)</div>
        <div class="col qty">Qté</div>
        <div class="col actions">Action</div>
      </div>

      <div class="components-list" id="componentsList" aria-live="polite"></div>

      <div class="card-footer">
        <button id="btnClearAll" class="ghost">Réinitialiser</button>
        <div class="footer-note">Saisis en <strong>mm</strong>. Quantité entière.</div>
      </div>
    </section>

    <!-- RIGHT : résumé minimal (surface totale, qty, couronne) -->
    <section class="card column-right">
      <div class="card-header">
        <div class="title">Récapitulatif</div>
        <div class="actions"></div>
      </div>

      <div class="metrics-row" style="display:flex;gap:12px;margin-bottom:8px;">
        <div class="metric small-metric">
          <div class="label">Surface totale</div>
          <div id="totalSurface" class="value small-value">— mm²</div>
        </div>

        <div class="metric small-metric">
          <div class="label">Quantité totale</div>
          <div id="totalQty" class="value small-value">—</div>
        </div>
      </div>


      <div class="table-wrap">
        <table id="summaryTable" class="summary-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Nom</th>
              <th>Couronne (mm)</th>
              <th>Qté</th>
              <th>Surface totale (mm²)</th>
              <th></th>
            </tr>
          </thead>
          <tbody><!-- rempli par JS --></tbody>
        </table>
      </div>

      <div class="card-footer" style="margin-top:10px;">
        <button id="btnLoadExample" class="ghost">Charger exemple</button>
        <div style="margin-left:auto;" class="footer-note">Mise à jour automatique.</div>
      </div>
    </section>

    <!-- BOTTOM : calculateur L × l + preview rectangle simple -->
    <section class="card full-width">
      <div class="card-header">
        <div class="title">Calculateur (surface ⇄ L / l)</div>
        <div class="actions">
          <button id="btnResetAdapt" class="ghost">Réinitialiser</button>
        </div>
      </div>

      <div class="adapt-row" style="align-items:center;">
        <label class="field" style="flex:1">
          <input id="inputTargetSurface" placeholder="Surface cible (mm²) — ex: 30.00" inputmode="decimal" type="number" step="0.01" aria-label="Surface cible en millimètres carrés">
        </label>

        <label class="field" style="width:180px;">
          <input id="fixL" placeholder="Fixer L (mm) — ex: 20" inputmode="decimal" type="number" step="0.01" aria-label="Longueur en millimètres">
        </label>

        <label class="field" style="width:180px;">
          <input id="fixl" placeholder="Fixer l (mm) — ex: 5" inputmode="decimal" type="number" step="0.01" aria-label="Largeur en millimètres">
        </label>
      </div>

      <div class="calc-note" style="margin-top:8px;">Fournir S+L ou S+l afin de calculer la variable manquante. Entrees en mm / mm².</div>

      <!-- preview box : seul le rectangle animé sera visible -->
      <div id="previewArea" style="margin-top:12px; display:flex; gap:12px; align-items:center;">
        <div style="flex:1; min-height:140px; display:flex; align-items:center; justify-content:center;">
          <!-- SVG simplifié : fond transparent (suit le card-bg), rectangle animé sera visible -->
          <svg id="previewCanvas" width="320" height="160" viewBox="0 0 320 160" style="background:transparent; border-radius:8px;" role="img" aria-label="Aperçu du composant non à l'échelle"></svg>
        </div>

        <div style="width:200px; display:flex; flex-direction:column; gap:8px;">
          <div style="display:flex; justify-content:space-between; gap:8px;">
            <div class="small muted">L</div><div id="previewL" class="small muted">— mm</div>
          </div>
          <div style="display:flex; justify-content:space-between; gap:8px;">
            <div class="small muted">l</div><div id="previewl" class="small muted">— mm</div>
          </div>
          <div style="height:8px"></div>
          <div class="small muted">Aperçu non à l'échelle — valeurs en millimètres.</div>
        </div>
      </div>

    </section>

  </main>

  <footer class="footer-row">
    <div class="small">François Bordas — <a href="mailto:francois.bordas@etu.univ-amu.fr">francois.bordas@etu.univ-amu.fr</a></div>
  </footer>
</body>
</html>
